【問題分析】

求圖的最大權不相交路徑及其變種，用費用最大流解決。

【建模方法】

規則(1)

把梯形中每個位置抽像為兩個點<i.a>,<i.b>，建立附加源S匯T。

1、對於每個點i從<i.a>到<i.b>連接一條容量為1，費用為點i權值的有向邊。
2、從S向梯形頂層每個<i.a>連一條容量為1，費用為0的有向邊。
3、從梯形底層每個<i.b>向T連一條容量為1，費用為0的有向邊。
4、對於每個點i和下面的兩個點j，分別連一條從<i.b>到<j.a>容量為1，費用為0的有向邊。

求最大費用最大流，費用流值就是結果。

規則(2)

把梯形中每個位置看做一個點i，建立附加源S匯T。

1、從S向梯形頂層每個i連一條容量為1，費用為0的有向邊。
2、從梯形底層每個i向T連一條容量為無窮大，費用為0的有向邊。
3、對於每個點i和下面的兩個點j，分別連一條從i到j容量為1，費用為點i權值的有向邊。

求最大費用最大流，費用流值就是結果。

規則(3)

把梯形中每個位置看做一個點i，建立附加源S匯T。

1、從S向梯形頂層每個i連一條容量為1，費用為0的有向邊。
2、從梯形底層每個i向T連一條容量為無窮大，費用為0的有向邊。
3、對於每個點i和下面的兩個點j，分別連一條從i到j容量為無窮大，費用為點i權值的有向邊。

求最大費用最大流，費用流值就是結果。

【建模分析】

對於規則1，要求路徑完全不相交，也就是每個點最多只能被訪問了一次，所以要把點拆分，之間連接容量為1的邊。因為任意一條ST之間的路徑都是一個解，在拆分的點內部的邊費用設為點的權值，求最大費用最大流就是費用最大的m條路經。

對於規則2，要求路徑可以相交，但不能有重疊，此時可以不必拆點了。為了保證路徑沒有重疊，需要在相鄰的兩個點上限制流量為1，由於頂層的每個點只能用1次，S向頂層點流量限制也為1。費用只需設在相鄰點的邊上，求最大費用最大流即可。

對於規則3，要求路徑除了頂層每個點以外可以任意相交重疊。在規則2的基礎上，取消除S到頂層頂點之間的邊以外所有邊的流量限制即可。